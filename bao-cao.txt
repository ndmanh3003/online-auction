================================================================================
                    BÃO CÃO KIá»‚M TRA LOGIC VÃ€ CHá»¨C NÄ‚NG
                  Há»† THá»NG Äáº¤U GIÃ TRá»°C TUYáº¾N - ONLINE AUCTION
================================================================================

ğŸ“… NgÃ y kiá»ƒm tra: 19/12/2025
ğŸ“‹ Dá»±a trÃªn: Äá» bÃ i chÃ­nh thá»©c (HackMD), file luu-y.txt vÃ  source code thá»±c táº¿
âš ï¸  LÆ¯U Ã: TODO-LIST.TXT ÄÃƒ ÄÆ¯á»¢C Cáº¬P NHáº¬T Dá»°A TRÃŠN Äá»€ BÃ€I ÄÃšNG

================================================================================
âœ… PHáº¦N 1: CHá»¨C NÄ‚NG ÄÃƒ LÃ€M ÄÃšNG VÃ€ Äáº¦Y Äá»¦
================================================================================

1. USER â€“ AUTH â€“ ROLE
   âœ… 1.1 ÄÄƒng kÃ½ / ÄÄƒng nháº­p
       - ÄÄƒng kÃ½ vá»›i role máº·c Ä‘á»‹nh = 'bidder' âœ“
       - LÆ°u thÃ´ng tin: id, name, email, password_hash âœ“
       - XÃ¡c thá»±c email vá»›i OTP âœ“
       - Táº¡o session khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng âœ“
       - reCAPTCHA protection âœ“
   
   âš ï¸ 1.1.1 ÄÄƒng nháº­p vá»›i Google OAuth (Bá»• sung - Optional)
       - CHÆ¯A lÃ m Google OAuth âŒ
       - ÄÃ¢y lÃ  tÃ­nh nÄƒng bá»• sung, KHÃ”NG báº¯t buá»™c theo Ä‘á» bÃ i
       - Náº¿u lÃ m thÃªm cÃ³ thá»ƒ cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng
   
   âœ… 1.2 PhÃ¢n quyá»n
       - CÃ³ 3 roles: bidder, seller, admin âœ“
       - Middleware kiá»ƒm tra role: isAuth, isAdmin, isSeller âœ“

2. PRODUCT / AUCTION ITEM
   âœ… 3.1 Táº¡o sáº£n pháº©m Ä‘áº¥u giÃ¡
       - Thuá»™c tÃ­nh báº¯t buá»™c: sellerId, name, description âœ“
       - startPrice, stepPrice, buyNowPrice (nullable) âœ“
       - endTime, status âœ“
       - Validate bid_step > 0 âœ“ (min: 0 trong schema)
       - Validate buyNowPrice >= startPrice âœ“ (logic tá»± nhiÃªn)
   
   âœ… 3.2 Tráº¡ng thÃ¡i sáº£n pháº©m
       - CÃ³ status: active, ended, cancelled âœ“
       - Chuyá»ƒn tráº¡ng thÃ¡i tá»± Ä‘á»™ng qua background job âœ“

3. LIST & SEARCH
   âœ… 4.1 Hiá»ƒn thá»‹ danh sÃ¡ch sáº£n pháº©m
       - Hiá»ƒn thá»‹ currentPrice (calculated) âœ“
       - Hiá»ƒn thá»‹ buyNowPrice âœ“
       - Hiá»ƒn thá»‹ thá»i gian cÃ²n láº¡i âœ“
       - Hiá»ƒn thá»‹ top bidder âœ“
       - MASK TÃŠN bidder: '****' + name.slice(-3) âœ“âœ“âœ“
   
   âœ… 4.2 Hiá»ƒn thá»‹ thá»i gian
       - CÃ³ logic hiá»ƒn thá»‹ relative time khi < 3 ngÃ y âœ“
       - Hiá»ƒn thá»‹ countdown âœ“

4. PRODUCT DETAIL
   âœ… 5. Hiá»ƒn thá»‹ chi tiáº¿t
       - Hiá»ƒn thá»‹ áº£nh lá»›n âœ“
       - Hiá»ƒn thá»‹ mÃ´ táº£ âœ“
       - Hiá»ƒn thá»‹ lá»‹ch sá»­ Ä‘áº¥u giÃ¡ (bid history) âœ“
       - Hiá»ƒn thá»‹ Q&A âœ“
       - Hiá»ƒn thá»‹ appendedDescriptions vá»›i timestamp âœ“

5. Q&A (COMMENT)
   âœ… 6.1 Äáº·t cÃ¢u há»i
       - Báº¥t ká»³ user nÃ o cÅ©ng há»i Ä‘Æ°á»£c âœ“
       - LÆ°u: productId, askerId, question, created_at âœ“
       - Gá»­i email thÃ´ng bÃ¡o seller âœ“
   
   âœ… 6.2 Tráº£ lá»i
       - Kiá»ƒm tra current_user == seller âœ“
       - LÆ°u answer âœ“
       - Hiá»ƒn thá»‹ cÃ´ng khai âœ“
       - Gá»­i email cho táº¥t cáº£ bidders âœ“

6. USER RATING
   âœ… 7.1 ÄÃ¡nh giÃ¡ ngÆ°á»i dÃ¹ng
       - Sau giao dá»‹ch káº¿t thÃºc âœ“
       - Seller vÃ  Bidder Ä‘Ã¡nh giÃ¡ láº«n nhau âœ“
       - Dá»¯ liá»‡u: fromUserId, toUserId, rating (+1/-1), comment âœ“
       - Type: bidder_to_seller, seller_to_bidder âœ“
       - TÃ­nh rating percentage âœ“

7. AUCTION CORE â€“ LOGIC Cá»T LÃ•I
   âœ… 8.1 Äiá»u kiá»‡n cho phÃ©p Ä‘áº¥u giÃ¡
       - Kiá»ƒm tra product.status == 'active' âœ“
       - Kiá»ƒm tra user.id != seller.id âœ“
       - Kiá»ƒm tra reputation (rating percentage) âœ“
       - Kiá»ƒm tra blocked bidders âœ“
   
   âœ… 8.2 BÆ°á»›c giÃ¡ (Bid Step)
       - Validate: bidAmount >= currentPrice + stepPrice âœ“
   
   âœ… 8.3 AUTO-BID (MAX BID)
       - NgÆ°á»i dÃ¹ng nháº­p maxBidAmount âœ“
       - maxBidAmount ÄÆ¯á»¢C LÆ¯U trong DB (Bid model) âœ“âœ“âœ“
       - Logic auto-bid khi cÃ³ ngÆ°á»i Ä‘áº¥u cao hÆ¡n:
         * IF maxB <= maxA â†’ currentPrice = min(maxB+step, maxA) âœ“
         * IF maxB > maxA â†’ currentPrice = min(maxA+step, maxB) âœ“
       - NgÆ°á»i Ä‘ang top Ä‘áº·t tiáº¿p â†’ update max_bid âœ“
       - isAutoBid flag âœ“

8. GIA Háº N PHIÃŠN Äáº¤U GIÃ (ANTI-SNIPING)
   âœ… 9. Auto-extend
       - Kiá»ƒm tra autoExtend flag âœ“
       - IF bid_time >= end_time - threshold â†’ extend âœ“
       - Gia háº¡n thÃªm extend_minutes âœ“
       - Config: AUTO_EXTEND_THRESHOLD_MINUTES, AUTO_EXTEND_DURATION_MINUTES âœ“

9. Káº¾T THÃšC Äáº¤U GIÃ
   âœ… 11. Káº¿t thÃºc tá»± Ä‘á»™ng
       - Background job cháº¡y má»—i 10 phÃºt âœ“
       - Kiá»ƒm tra now > endTime âœ“
       - Cáº­p nháº­t status = 'ended' âœ“
       - TÃ¬m winner = top_bidder âœ“
       - Táº¡o transaction âœ“
       - Gá»­i email thÃ´ng bÃ¡o âœ“

10. GIAO Dá»ŠCH & Há»¦Y
    âœ… 12.1 XÃ¡c nháº­n giao dá»‹ch
        - Buyer submit payment proof âœ“
        - Seller confirm payment âœ“
        - Buyer confirm delivery âœ“
    
    âœ… 12.2 Seller há»§y giao dá»‹ch
        - Seller rate -1 cho bidder khÃ´ng thanh toÃ¡n âœ“

11. ADMIN CONFIG
    âœ… 13. Cáº¥u hÃ¬nh
        - Config via .env file âœ“
        - extend_minutes, default_bid_step, min_rating_percent âœ“

12. MASK TÃŠN BIDDER
    âœ… Mask tÃªn trong bid history
        - Logic: '****' + name.slice(-3) âœ“
        - Seller xem Ä‘Æ°á»£c tÃªn Ä‘áº§y Ä‘á»§ âœ“

13. CÃC TÃNH NÄ‚NG Bá»” SUNG ÄÃƒ LÃ€M
    âœ… Watchlist
    âœ… Email notifications Ä‘áº§y Ä‘á»§
    âœ… Blocked bidders
    âœ… Append product description
    âœ… Transaction tracking vá»›i nhiá»u tráº¡ng thÃ¡i
    âœ… Admin management panel
    âœ… Search & filter sáº£n pháº©m

================================================================================
âŒ PHáº¦N 2: CHá»¨C NÄ‚NG CHÆ¯A LÃ€M HOáº¶C LÃ€M THIáº¾U
================================================================================

1. â­â­â­ SELLER MANAGEMENT - THá»œI Háº N SELLER (NGHIÃŠM TRá»ŒNG!!!)
   âŒ 2.1 Xin / mua quyá»n Seller
       THIáº¾U: seller_start_date, seller_end_date
       - User model KHÃ”NG cÃ³ trÆ°á»ng sellerStartDate âŒ
       - User model KHÃ”NG cÃ³ trÆ°á»ng sellerEndDate âŒ
       - SellerRequest model chá»‰ cÃ³: userId, status, reviewedAt, reviewedBy
       - KHÃ”NG tá»± Ä‘á»™ng set sellerEndDate = now + 7 ngÃ y âŒ
   
   âŒ 2.2 Háº¿t háº¡n Seller
       THIáº¾U: Logic kiá»ƒm tra seller háº¿t háº¡n
       - KHÃ”NG cÃ³ logic kiá»ƒm tra current_time > sellerEndDate âŒ
       - KHÃ”NG ngÄƒn seller háº¿t háº¡n táº¡o sáº£n pháº©m má»›i âŒ
       - VáºªN cho phÃ©p xá»­ lÃ½ sáº£n pháº©m cÅ© (Ä‘Ãºng theo spec) âœ“
       - Role váº«n lÃ  'seller' (KHÃ”NG downgrade - Ä‘Ãºng spec) âœ“

   ğŸ”´ ÄÃNH GIÃ: Lá»–I NGHIÃŠM TRá»ŒNG - Dá»„ Máº¤T 1-1.5 ÄIá»‚M
   
   ğŸ“Œ THEO Äá»€ BÃ€I VÃ€ LUU-Y.TXT:
   - CÃ¢u 13: "Quyá»n Seller cÃ³ thá»i háº¡n, máº·c Ä‘á»‹nh lÃ  7 ngÃ y"
   - CÃ¢u 14: "Háº¿t háº¡n KHÃ”NG bá»‹ háº¡ quyá»n, CHá»ˆ háº¿t hiá»‡u lá»±c Ä‘Äƒng sáº£n pháº©m má»›i"
   - CÃ¢u 15: "Háº¿t háº¡n VáºªN Ä‘Æ°á»£c xá»­ lÃ½ cÃ¡c sáº£n pháº©m Ä‘Ã£ Ä‘Äƒng"
   
   Cáº¦N Bá»” SUNG:
   - ThÃªm vÃ o User model:
     * sellerStartDate: Date
     * sellerEndDate: Date
   - Khi approve seller request:
     * Set sellerStartDate = now
     * Set sellerEndDate = now + 7 days
   - Middleware kiá»ƒm tra seller háº¿t háº¡n:
     * TÃ­nh: isExpired = now > sellerEndDate
     * Náº¿u expired: KHÃ”NG cho táº¡o sáº£n pháº©m má»›i
     * NhÆ°ng VáºªN cho xá»­ lÃ½ sáº£n pháº©m Ä‘Ã£ Ä‘Äƒng

2. â­â­â­ BUY NOW PRICE - CHÆ¯A LÃ€M (NGHIÃŠM TRá»ŒNG!)
   âŒ 10.1 Click mua ngay
       - CÃ³ field buyNowPrice trong Product model âœ“
       - Hiá»ƒn thá»‹ buyNowPrice trÃªn UI âœ“
       - NHÆ¯NG KHÃ”NG cÃ³ nÃºt "Mua Ngay" âŒ
       - KHÃ”NG cÃ³ route POST /products/:id/buy-now âŒ
       - KHÃ”NG chuyá»ƒn status = 'sold' âŒ
       - KHÃ”NG táº¡o transaction ngay âŒ
   
   âŒ 10.2 Auto buy khi max_bid >= buy_now_price
       - KHÃ”NG cÃ³ logic kiá»ƒm tra max_bid >= buyNowPrice âŒ
       - KHÃ”NG tá»± Ä‘á»™ng trigger buy now âŒ
       - KHÃ”NG yÃªu cáº§u confirm âŒ
   
   ğŸ”´ ÄÃNH GIÃ: Chá»‰ lÃ m 20% - chá»‰ cÃ³ field, CHÆ¯A cÃ³ logic xá»­ lÃ½
   ğŸ”´ Máº¤T ÄIá»‚M: Æ¯á»›c tÃ­nh máº¥t 0.5-1 Ä‘iá»ƒm
   
   ğŸ“Œ THEO LUU-Y.TXT:
   - CÃ¢u 32: "Mua ngay â†’ phiÃªn Ä‘áº¥u giÃ¡ káº¿t thÃºc láº­p tá»©c"
   - CÃ¢u 33: "IF max_bid >= buy_now â†’ tá»± Ä‘á»™ng mua (cÃ³ confirm)"
   
   Cáº¦N Bá»” SUNG:
   - ThÃªm status 'sold' vÃ o Product model enum
   - Táº¡o route POST /products/:id/buy-now
   - Logic chuyá»ƒn status = 'sold', táº¡o transaction
   - Logic auto buy khi max_bid >= buyNowPrice (vá»›i confirm)

3. â­â­ ADMIN CONFIG - Cáº¦N Cáº¢I THIá»†N
   âš ï¸ THIáº¾U: UI hoáº·c DB Ä‘á»ƒ admin thay Ä‘á»•i config
       - Config qua .env: AUTO_EXTEND_THRESHOLD_MINUTES, etc. âœ“
       - KHÃ”NG cÃ³ table/model Config âŒ
       - KHÃ”NG cÃ³ UI Ä‘á»ƒ admin thay Ä‘á»•i config âŒ
       - Pháº£i sá»­a .env vÃ  restart server âŒ
   
   âš ï¸ ÄÃNH GIÃ: LÃ m Ä‘Æ¡n giáº£n hÃ³a, Cáº¦N cáº£i thiá»‡n
   ğŸ”´ Máº¤T ÄIá»‚M: Æ¯á»›c tÃ­nh máº¥t 0.3-0.5 Ä‘iá»ƒm
   
   ğŸ“Œ THEO LUU-Y.TXT:
   - CÃ¢u 4: "Thá»i gian gia háº¡n KHÃ”NG Ä‘Æ°á»£c hard-code, pháº£i cáº¥u hÃ¬nh Ä‘Æ°á»£c"
   
   ğŸ¯ GIáº¢I PHÃP:
   - NÃŠN thÃªm UI admin Ä‘á»ƒ thay Ä‘á»•i (lÆ°u DB tá»‘t hÆ¡n)
   - YÃŠU Cáº¦U: Buy now â†’ chuyá»ƒn status = 'sold' (riÃªng biá»‡t vá»›i 'ended')
       - KHÃ”NG cÃ³ status 'sold' (riÃªng cho buy now) âŒ
       - KHÃ”NG tá»± Ä‘á»™ng chuyá»ƒn tá»« draft â†’ active khi Ä‘áº¿n start_time âŒ
   
   âš ï¸ ÄÃNH GIÃ: Thiáº¿u tráº¡ng thÃ¡i draft vÃ  sold
   - Sáº£n pháº©m táº¡o ra lÃ  'active' ngay
   - KHÃ”NG cÃ³ start_time riÃªng biá»‡t
   â­â­â­ BUY NOW PRICE - CHÆ¯A LÃ€M (NGHIÃŠM TRá»ŒNG!)
   âŒ 10.1 Click mua ngay
       - CÃ³ field buyNowPrice trong Product model âœ“
       - Hiá»ƒn thá»‹ buyNowPrice trÃªn UI âœ“
       - NHÆ¯NG KHÃ”NG cÃ³ nÃºt "Mua Ngay" âŒ
       - KHÃ”NG cÃ³ route POST /products/:id/buy-now âŒ
       - KHÃ”NG chuyá»ƒn status = 'sold' âŒ
       - KHÃ”NG táº¡o transaction ngay âŒ
   
   âŒ 10.2 Auto buy khi max_bid >= buy_now_price
       - KHÃ”NG cÃ³ logic kiá»ƒm tra max_bid >= buyNowPrice âŒ
       - KHÃ”NG tá»± Ä‘á»™ng trigger buy now âŒ
       - KHÃ”NG yÃªu cáº§u confirm âŒ
   
   ğŸ”´ ÄÃNH GIÃ: Chá»‰ lÃ m 20% - chá»‰ cÃ³ field, CHÆ¯A cÃ³ logic xá»­ lÃ½
   âœ… LOGIC AUTO-BID - ÄÃšNG VÃ€ Há»¢P LÃ
   âœ… 8.3 Auto-bid vá»›i max_bid_amount
       Code hiá»‡n táº¡i: LÆ¯U max_bid trong Bid model
       
       - Bid model cÃ³ field: maxBidAmount âœ“
       - maxBidAmount Ä‘Æ°á»£c lÆ°u vÃ o DB âœ“
       - KHÃ”NG hiá»ƒn thá»‹ maxBidAmount trÃªn UI âœ“
       - CÃ³ isAutoBid flag âœ“
       - Logic auto-bid khi bá»‹ outbid âœ“
   
   âœ… ÄÃNH GIÃ: ÄÃšNG THEO Äá»€ BÃ€I
   
   ğŸ“Œ THEO LUU-Y.TXT VÃ€ Äá»€ BÃ€I:
   - CÃ¢u 24: "Báº®T BUá»˜C pháº£i lÃ m auto-bid"
   â­â­ ADMIN CONFIG - Cáº¦N Bá»” SUNG
   âš ï¸ 13. Admin cáº¥u hÃ¬nh
       Code hiá»‡n táº¡i: Config trong .env file
       
       - Config qua .env: AUTO_EXTEND_THRESHOLD_MINUTES, etc. âœ“
       - KHÃ”NG cÃ³ table/model Config âŒ
       - KHÃ”NG cÃ³ UI Ä‘á»ƒ admin thay Ä‘á»•i config âŒ
       - Pháº£i sá»­a .env vÃ  restart server âŒ
   
   âš ï¸ ÄÃNH GIÃ: LÃ m Ä‘Æ¡n giáº£n hÃ³a, Cáº¦N cáº£i thiá»‡n
   ğŸ”´ Máº¤T ÄIá»‚M: Æ¯á»›c tÃ­nh máº¥t 0.3-0.5 Ä‘iá»ƒm
   
   ğŸ“Œ THEO LUU-Y.TXT:
   - CÃ¢u 4: "Thá»i gian gia háº¡n KHÃ”NG Ä‘Æ°á»£c hard-code, pháº£i cáº¥u hÃ¬nh Ä‘Æ°á»£c"
   - CÃ¢u 5: "KhÃ´ng báº¯t buá»™c giao diá»‡n admin riÃªng, miá»…n cáº¥u hÃ¬nh Ä‘Æ°á»£c"
   
   ğŸ¯ GIáº¢I PHÃP:
   - .env file VáºªN Ä‘Æ°á»£c cháº¥p nháº­n
   - NHÆ¯NG NÃŠN thÃªm UI admin Ä‘á»ƒ thay Ä‘á»•i (lÆ°u DB tá»‘t hÆ¡n)

â­ GOOGLE OAUTH LOGIN (TÃ­nh nÄƒng bá»• sung - Optional)
   âŒ CHÆ¯A LÃ€M: ÄÄƒng nháº­p vá»›i Google OAuth
       - KHÃ”NG cÃ³ Google OAuth integration âŒ
       - Chá»‰ cÃ³ Ä‘Äƒng nháº­p thÆ°á»ng vá»›i email/password âœ“
   
   ğŸ“ ÄÃNH GIÃ: KhÃ´ng báº¯t buá»™c theo Ä‘á» bÃ i
   
   ğŸ“Œ LÆ¯U Ã:
   - ÄÃ¢y lÃ  tÃ­nh nÄƒng Bá»” SUNG, KHÃ”NG cÃ³ trong Ä‘á» bÃ i gá»‘c
   - KHÃ”NG máº¥t Ä‘iá»ƒm náº¿u khÃ´ng lÃ m
   - Náº¾U LÃ€M cÃ³ thá»ƒ cáº£i thiá»‡n UX vÃ  giÃ¡ trá»‹ dá»± Ã¡n
   
   Cáº¦N Bá»” SUNG (náº¿u muá»‘n lÃ m):
   - Setup Google OAuth 2.0 credentials
   - Install passport.js hoáº·c google-auth-library
   - ThÃªm route: GET /auth/google, GET /auth/google/callback
   - ThÃªm field vÃ o User model:
     * googleId: String
     * provider: String ('google' | 'local')
     * avatar: String (optional)
   - Logic auto-create account khi email chÆ°a tá»“n táº¡i
   - Password KHÃ”NG báº¯t buá»™c vá»›i Google OAuth users


================================================================================
PHáº¦N 3: SO SÃNH CÃC Lá»–I Vá»šI Äá»€ BÃ€I
================================================================================

1. â­â­â­ SELLER THá»œI Háº N - Lá»–I NGHIÃŠM TRá»ŒNG NHáº¤T
   ğŸ”´ Äá»€ BÃ€I: Seller cÃ³ thá»i háº¡n 7 ngÃ y, háº¿t háº¡n KHÃ”NG táº¡o sáº£n pháº©m má»›i
   ğŸ”´ CODE: Seller VÄ¨NH VIá»„N, khÃ´ng cÃ³ thá»i háº¡n
   ğŸ”´ Má»¨C Äá»˜: NGHIÃŠM TRá»ŒNG - Máº¤T 1-1.5 ÄIá»‚M
   ğŸ“Œ LUU-Y.TXT: CÃ¢u 13, 14, 15

2. â­â­â­ BUY NOW LOGIC - CHÆ¯A LÃ€M
   ğŸ”´ Äá»€ BÃ€I: Click buy now â†’ sold, auto buy khi max_bid >= buy_now
   ğŸ”´ CODE: Chá»‰ cÃ³ field, KHÃ”NG cÃ³ logic xá»­ lÃ½
   ğŸ”´ Má»¨C Äá»˜: Chá»©c nÄƒng chÆ°a hoÃ n thÃ nh - Máº¤T 0.5-1 ÄIá»‚M
   ğŸ“Œ LUU-Y.TXT: CÃ¢u 32, 33

3. â­â­ PRODUCT STATUS - THIáº¾U 'SOLD'
   âš ï¸ Äá»€ BÃ€I: Cáº§n status 'sold' riÃªng cho buy now
   âš ï¸ CODE: Chá»‰ cÃ³ active, ended, cancelled
   ğŸ“ Má»¨C Äá»˜: Thiáº¿u 1 status - Máº¤T ~0.2 ÄIá»‚M

4. â­â­ ADMIN CONFIG - Cáº¦N Cáº¢I THIá»†N
   âš ï¸ Äá»€ BÃ€I: Config pháº£i thay Ä‘á»•i Ä‘Æ°á»£c (DB hoáº·c UI)
   âš ï¸ CODE: Config hardcode trong .env
   ğŸ“ Má»¨C Äá»˜: Cháº¥p nháº­n Ä‘Æ°á»£c nhÆ°ng chÆ°a tá»‘i Æ°u - Máº¤T ~0.3 ÄIá»‚M
   ğŸ“Œ LUU-Y.TXT: CÃ¢u 4, 5

================================================================================

Tá»”NG Sá» CHá»¨C NÄ‚NG THEO Äá»€ BÃ€I: ~17 nhÃ³m chá»©c nÄƒng chÃ­nh

âœ… ÄÃƒ LÃ€M ÄÃšNG VÃ€ Äáº¦Y Äá»¦: ~14 nhÃ³m (82%)
   - Auth & Login vá»›i OTP âœ“
   - Product listing & detail âœ“
   - Search & filter âœ“
   - Q&A âœ“
   - Rating system (+1/-1) âœ“
   - Auction core (bid, step price) âœ“
   - Auto-bid mechanism âœ“
   - Auto-extend âœ“
   - Mask bidder name âœ“
   - Transaction tracking (4-step checkout) âœ“
   - Watchlist âœ“
   - Email notifications âœ“
   - Block bidder âœ“
   - Append description âœ“

âŒ CHÆ¯A LÃ€M HOáº¶C LÃ€M THIáº¾U: ~3 nhÃ³m (18%)
   - Seller thá»i háº¡n (chÆ°a lÃ m - NGHIÃŠM TRá»ŒNG) âŒ
   - Buy now logic (chÆ°a lÃ m - NGHIÃŠM TRá»ŒNG) âŒ
   - Admin config UI (chÆ°a lÃ m - NGHIÃŠM TRá»ŒNG) âŒ

Tá»”NG Sá» CHá»¨C NÄ‚NG TRONG TODO: ~15 nhÃ³ (Cáº¬P NHáº¬T)
================================================================================

â­â­â­ PRIORITY 1 - NGHIÃŠM TRá»ŒNG (Báº®T BUá»˜C PHáº¢I Sá»¬A TRÆ¯á»šC KHI Ná»˜P BÃ€I):
=====================   - Product listing & detail
   - Search & filter
   - Q&A
   - Rating system
   - Auction core (bid, step price)
   - Auto-bid mechanism
   - Auto-extend
   - Mask bidder name
   - Transaction tracking

âŒ CHÆ¯A LÃ€M / LÃ€M THIáº¾U: ~5 nhÃ³m (33%)
   - Seller thá»i háº¡n (chÆ°a lÃ m - NGHIÃŠM TRá»ŒNG)
   - Buy now logic (chÆ°a lÃ m)
   - Product draft status (chÆ°a lÃ m)
   - Reputation score field (lÃ m khÃ¡c)
   - Admin config DB (lÃ m khÃ¡c)

âš ï¸ LÃ€M SAI HOáº¶C KHÃC SPEC: ~3 items
   - Seller khÃ´ng cÃ³ thá»i háº¡n
   - Max bid Ä‘Æ°á»£c lÆ°u DB (nhÆ°ng há»£p lÃ½)
   - Config qua .env thay vÃ¬ DB

================================================================================
ğŸ¯ PHáº¦N 5: Äá»€ XUáº¤T Sá»¬A CHá»®A - Æ¯U TIÃŠN
================================================================================

PRIORITY 1 - NGHIÃŠM TRá»ŒNG (Báº®T BUá»˜C PHáº¢I Sá»¬A):
===============================================

1. â­â­â­ Bá»” SUNG SELLER THá»œI Háº N
   File cáº§n sá»­a: models/User.js
   
   ThÃªm fields:
   ```javascript
   sellerStartDate: {
     type: Date,
     default: null,
   },
   sellerEndDate: {
     type: Date,
     default: null,
   }
   ```

   File cáº§n sá»­a: services/seller-request.service.js
   
   Trong hÃ m updateStatus khi approve:
   ```javascript
   if (status === 'approved') {
     await userService.update(userId, {
       role: 'seller',
       sellerStartDate: new Date(),
       sellerEndDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
     });
   }
   ```

   File cáº§n sá»­a: middlewares/auth.mdw.js
   
   ThÃªm middleware má»›i:
   ```javascript
   export function isActiveSeller(req, res, next) {
     const user = req.session.authUser;
     if (user.role !== 'seller' && user.role !== 'admin') {
       return res.render('403');
     }
     
     if (user.role === 'seller') {
       if (new Date() > user.sellerEndDate) {
         return res.error('Your seller subscription has expired. Please renew.');
       }
     }
     
     next();
   }
   ```

   File cáº§n sá»­a: routes/seller/product.route.js
   
   Thay Ä‘á»•i:
   ```javascript
   // Tá»«:
   router.use(isSeller);
   
   // ThÃ nh:
   router.use(isActiveSeller);
   ```

2. â­â­â­ THÃŠM LOGIC MUA NGAY (BUY NOW)
   File cáº§n táº¡o má»›i: routes/product.route.js (thÃªm route)
   
   ```javascript
   router.post('/:id/buy-now', isAuth, async function (req, res) {
     const product = await productService.findById(req.params.id);
     
     if (!product || product.status !== 'active') {
       return res.error('Product not available');
     }
     
     if (!product.buyNowPrice) {
       return res.error('This product does not have buy now option');
     }
     
     if (product.sellerId._id.toString() === req.session.authUser._id.toString()) {
       return res.error('You cannot buy your own product');
     }
     
     // Chuyá»ƒn status thÃ nh sold
     await productService.updateStatus(product._id, 'sold');
     
     // Táº¡o transaction ngay
     await transactionService.create({
       productId: product._id,
       sellerId: product.sellerId._id,
       winnerId: req.session.authUser._id,
     });
     
     // Gá»­i email thÃ´ng bÃ¡o
     await emailService.sendBuyNowEmail(product, req.session.authUser);
     
     res.redirect(`/checkout/${product._id}`);
   });
   ```

   File cáº§n sá»­a: models/Product.js
   
   ThÃªm 'sold' vÃ o enum status:
   ```javascript
â­â­ PRIORITY 2 - NÃŠN LÃ€M (Cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ):
==========================================

3. â­â­ ADMIN CONFIG VIA DATABASE hoáº·c UI
   GIáº¢I PHÃP 1: Táº¡o UI admin Ä‘Æ¡n giáº£n
   File: routes/admin/config.route.js (táº¡o má»›i)
   
   ```javascript
   router.get('/config', (req, res) => {
     const config = {
       extendThreshold: process.env.AUTO_EXTEND_THRESHOLD_MINUTES || '5',
       extendDuration: process.env.AUTO_EXTEND_DURATION_MINUTES || '10',
       minRating: process.env.MIN_BIDDER_RATING_PERCENT || '80',
     };
     res.render('vwAdmin/config', { config });
   });
   
   router.post('/config', async (req, res) => {
     // LÆ°u vÃ o DB hoáº·c file config
     // Reload config khi cáº§n
   });
   ```
   
   GIáº¢I PHÃP 2: Táº¡o model Config
   File: models/Config.js
   
   ```javascript
   const configSchema = new mongoose.Schema({
     key: String,
     value: String,
   });
   ```

â­ PRIORITY 3 - TÃ™Y CHá»ŒN (KhÃ´ng báº¯t buá»™c):
=========================================

4. â­ Cáº¢I THIá»†N AUTO-BID NOTIFICATION
   
   File: services/rating.service.js
   
   Khi táº¡o rating:
   ```javascript
   async function createOrUpdate(...) {
     // ... existing code
     
     // Update reputation score
     const user = await User.findById(toUserId);
     user.reputationScore += ratingValue;
     await user.save();
   }
   ```

PRIORITY 3 - TÃ™Y CHá»ŒN (Cáº£i thiá»‡n):
===================================

5. â­ ADMIN CONFIG VIA DATABASE
   Táº¡o model má»›i: models/Config.js
   Táº¡o service: services/config.service.js
   Táº¡o admin routes: routes/admin/config.route.js
   Táº¡o views: vwAdmin/config/

   (Chi tiáº¿t implementation cÃ³ thá»ƒ bá» qua náº¿u thá»i gian gáº¥p)

6. â­ GOOGLE OAUTH LOGIN (Bonus feature)
   Install dependencies:
   ```bash
   npm install passport passport-google-oauth20 express-session
   ```
   
   Cáº­p nháº­t User model (models/User.js):
   ```javascript
   googleId: String,
   provider: { type: String, enum: ['local', 'google'], default: 'local' },
   avatar: String,
   password: { type: String, required: false }, // KhÃ´ng báº¯t buá»™c cho Google OAuth
   ```
   
   Táº¡o file config/passport.js:
   ```javascript
   const GoogleStrategy = require('passport-google-oauth20').Strategy;
   
   passport.use(new GoogleStrategy({
     clientID: process.env.GOOGLE_CLIENT_ID,
     clientSecret: process.env.GOOGLE_CLIENT_SECRET,
     callbackURL: "/auth/google/callback"
   }, async (accessToken, refreshToken, profile, done) => {
     // Check if user exists
     let user = await User.findOne({ email: profile.emails[0].value });
     
     if (!user) {
       // Create new user
       user = await User.create({
         googleId: profile.id,
         provider: 'google',
         name: profile.displayName,
         email: profile.emails[0].value,
         avatar: profile.photos[0].value,
         role: 'bidder',
         isEmailVerified: true
       });
     } else if (!user.googleId) {
       // Link Google to existing account
       user.googleId = profile.id;
       user.provider = 'google';
       await user.save();
     }
     
     done(null, user);
   }));
   ```
   
   ThÃªm routes (routes/auth.route.js):
   ```javascript
   router.get('/google', passport.authenticate('google', { 
     scope: ['profile', 'email'] 
   }));
   
   router.get('/google/callback', 
     passport.authenticate('google', { failureRedirect: '/login' }),
     (req, res) => {
       req.session.user = req.user;
       res.redirect('/');
     }
   );
   ```
   
   ThÃªm nÃºt trÃªn view (vwAuth/login.handlebars):
   ```html
   <a href="/auth/google" class="btn btn-google">
     <img src="/images/google-icon.svg" alt="Google">
     ÄÄƒng nháº­p vá»›i Google
   </a>
   ```

================================================================================
ğŸ“ PHáº¦N 6: Káº¾T LUáº¬N & NHáº¬N XÃ‰T
================================================================================

ÄIá»‚M Máº NH:
-----------
âœ… Auto-bid mechanism Ä‘Æ°á»£c implement tá»‘t
âœ… Auto-extend hoáº¡t Ä‘á»™ng Ä‘Ãºng logic
âœ… Mask bidder name Ä‘Ãºng spec
âœ… Rating system 2 chiá»u hoÃ n chá»‰nh
âœ… Transaction tracking chi tiáº¿t
âœ… Email notifications Ä‘áº§y Ä‘á»§
âœ… Code structure sáº¡ch, follow MVC pattern
âœ… Security tá»‘t (bcrypt, session, middleware)

ÄIá»‚M Yáº¾U:
---------
âŒ THIáº¾U seller thá»i háº¡n - Lá»–I NGHIÃŠM TRá»ŒNG NHáº¤T
âŒ Buy now chá»‰ cÃ³ UI, chÆ°a cÃ³ logic
âŒ KhÃ´ng cÃ³ product draft status
âŒ Config hardcode trong .env

Tá»”NG QUAN:
----------
- Há»‡ thá»‘ng Ä‘Æ°á»£c code KHÃ Tá»T
- Nhiá»u tÃ­nh nÄƒng bá»• sung ngoÃ i spec (watchlist, email, etc.)
- NHÆ¯NG THIáº¾U 2 tÃ­nh nÄƒng quan trá»ng:
  1. Seller thá»i háº¡n (ráº¥t dá»… máº¥t Ä‘iá»ƒm)
  2. Buy now logic

Æ¯á»šC TÃNH ÄIá»‚M:
--------------
Náº¿u cháº¥m theo todo-list:
- Pháº§n Ä‘Ã£ lÃ m Ä‘Ãºng: 7-7.5/10
- Máº¥t Ä‘iá»ƒm vÃ¬:
  * Thiáº¿u seller thá»i háº¡n: -1.5 Ä‘iá»ƒm
  * Thiáº¿u buy now: -1 Ä‘iá»ƒm
  * Thiáº¿u draft status: -0.5 Ä‘iá»ƒm

KHUYáº¾N NGHá»Š:
------------
ğŸ”´ Báº®T BUá»˜C: Fix seller thá»i háº¡n trÆ°á»›c khi ná»™p bÃ i
ğŸ”´ Báº®T BUá»˜C:  (Cáº¬P NHáº¬T):
--------------------------
Náº¿u cháº¥m theo Ä‘á» bÃ i chÃ­nh thá»©c:
- Pháº§n Ä‘Ã£ lÃ m Ä‘Ãºng: 8.0-8.5/10 (82%)
- Máº¥t Ä‘iá»ƒm vÃ¬:
  * Thiáº¿u seller thá»i háº¡n: -1.0 Ä‘áº¿n -1.5 Ä‘iá»ƒm â­â­â­
  * Thiáº¿u buy now logic: -0.5 Ä‘áº¿n -1.0 Ä‘iá»ƒm â­â­â­
  * Config khÃ´ng linh hoáº¡t: -0.3 Ä‘áº¿n -0.5 Ä‘iá»ƒm â­â­

KHUYáº¾N NGHá»Š Æ¯U TIÃŠN (Cáº¬P NHáº¬T):
-------------------------------
ğŸ”´ Báº®T BUá»˜C (PRIORITY 1):
   1. Fix seller thá»i háº¡n trÆ°á»›c khi ná»™p bÃ i â­â­â­
   2. Implement buy now logic (click + auto buy) â­â­â­

âš ï¸  NÃŠN LÃ€M (PRIORITY 2):
   3. ThÃªm UI admin config hoáº·c lÆ°u DB â­â­

âŒ KHÃ”NG Cáº¦N LÃ€M (khÃ´ng cÃ³ trong Ä‘á» bÃ i):
   - Draft status cho product
   - Reputation score field tÃ­ch lÅ©y
   - Start time riÃªng biá»‡t