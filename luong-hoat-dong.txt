LUá»’NG HOáº T Äá»˜NG Há»† THá»NG Äáº¤U GIÃ ONLINE
================================================================================
MÃ´ táº£ chi tiáº¿t cÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a tá»«ng chá»©c nÄƒng
================================================================================

ğŸ“‹ Má»¤C Lá»¤C:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Luá»“ng ÄÄƒng kÃ½ & ÄÄƒng nháº­p
2. Luá»“ng Xin quyá»n Seller
3. Luá»“ng Táº¡o sáº£n pháº©m Ä‘áº¥u giÃ¡
4. Luá»“ng Äáº¥u giÃ¡ (Auto-bid)
5. Luá»“ng Gia háº¡n phiÃªn Ä‘áº¥u giÃ¡ (Auto-extend)
6. Luá»“ng Káº¿t thÃºc Ä‘áº¥u giÃ¡
7. Luá»“ng Checkout (4 bÆ°á»›c)
8. Luá»“ng ÄÃ¡nh giÃ¡ (Rating)
9. Luá»“ng Q&A (Há»i Ä‘Ã¡p)
10. Luá»“ng Watchlist
11. Luá»“ng Search & Filter
12. Luá»“ng Admin quáº£n lÃ½
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

================================================================================
1. LUá»’NG ÄÄ‚NG KÃ & ÄÄ‚NG NHáº¬P
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. ÄÄ‚NG KÃ TÃ€I KHOáº¢N                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Truy cáº­p /auth/register
   â†“
[Frontend] Hiá»ƒn thá»‹ form Ä‘Äƒng kÃ½ + reCAPTCHA
   â†“
[User] Nháº­p: name, email, password, dob, address
   â†“
[User] Giáº£i reCAPTCHA
   â†“
[POST /auth/register]
   â†“
[Backend] routes/auth.route.js â†’ Controller
   â†“
[Validation]
   â”œâ”€ Check reCAPTCHA token
   â”œâ”€ Check email Ä‘Ã£ tá»“n táº¡i chÆ°a
   â””â”€ Validate input
   â†“
[Backend] services/user.service.js
   â”œâ”€ Hash password (bcrypt)
   â”œâ”€ Create user: { name, email, password_hash, role: 'bidder', ... }
   â””â”€ Save to DB
   â†“
[Backend] utils/otp.js
   â”œâ”€ Generate OTP (6 sá»‘)
   â”œâ”€ Save to OTP table: { userId, code, expiresAt }
   â””â”€ Send email (utils/email.js)
   â†“
[Response] Redirect to /auth/verify-otp
   â†“
[User] Nháº­p OTP tá»« email
   â†“
[POST /auth/verify-otp]
   â†“
[Backend] Verify OTP
   â”œâ”€ Check code match
   â”œâ”€ Check expiration
   â””â”€ Update user: isEmailVerified = true
   â†“
[Response] Redirect to /auth/login

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. ÄÄ‚NG NHáº¬P                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Truy cáº­p /auth/login
   â†“
[Frontend] Hiá»ƒn thá»‹ form login
   â†“
[User] Nháº­p email + password
   â†“
[POST /auth/login]
   â†“
[Backend] routes/auth.route.js
   â†“
[Backend] services/user.service.js
   â”œâ”€ Find user by email
   â”œâ”€ Compare password (bcrypt.compare)
   â”œâ”€ Check isEmailVerified = true
   â””â”€ Validate success
   â†“
[Backend] Create session
   â”œâ”€ req.session.authUser = { _id, name, email, role, ... }
   â””â”€ Save session to store
   â†“
[Response] Redirect to /
   â†“
[Middleware] auth.mdw.js
   â”œâ”€ Attach req.session.authUser to res.locals.authUser
   â””â”€ Available in all views

================================================================================
2. LUá»’NG XIN QUYá»€N SELLER
================================================================================

[Bidder] Truy cáº­p /account/request-seller
   â†“
[Frontend] Hiá»ƒn thá»‹ form xin quyá»n seller
   â†“
[User] Click "Request Seller Permission"
   â†“
[POST /account/request-seller]
   â†“
[Backend] routes/account.route.js
   â†“
[Check] User Ä‘Ã£ lÃ  seller chÆ°a?
   â”œâ”€ YES â†’ Return error "Already a seller"
   â””â”€ NO â†’ Continue
   â†“
[Check] User Ä‘Ã£ cÃ³ request pending chÆ°a?
   â”œâ”€ YES â†’ Return error "Request already exists"
   â””â”€ NO â†’ Continue
   â†“
[Backend] services/seller-request.service.js
   â”œâ”€ Create: { userId, status: 'pending', createdAt }
   â””â”€ Save to SellerRequest table
   â†“
[Response] Redirect with success message
   â†“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Admin] Truy cáº­p /admin/seller-requests
   â†“
[Backend] Fetch all pending requests
   â”œâ”€ Populate userId (name, email)
   â””â”€ Sort by createdAt desc
   â†“
[Frontend] Hiá»ƒn thá»‹ danh sÃ¡ch requests
   â†“
[Admin] Click "Approve" hoáº·c "Deny"
   â†“
[POST /admin/seller-requests/:id/approve]
   â†“
[Backend] routes/admin/seller-requests.route.js
   â†“
[Backend] services/seller-request.service.js
   â”œâ”€ Update request: { status: 'approved', reviewedAt, reviewedBy }
   â””â”€ Save
   â†“
[Backend] services/user.service.js
   â”œâ”€ Update user: { role: 'seller' }
   â””â”€ Save
   â†“
[Response] Redirect back to /admin/seller-requests

NOTE: âŒ Lá»–I - THIáº¾U SET sellerStartDate, sellerEndDate (7 ngÃ y)

================================================================================
3. LUá»’NG Táº O Sáº¢N PHáº¨M Äáº¤U GIÃ
================================================================================

[Seller] Truy cáº­p /seller/products/create
   â†“
[Middleware] auth.mdw.js
   â”œâ”€ Check logged in
   â””â”€ Check role === 'seller'
   â†“
[Frontend] Hiá»ƒn thá»‹ form táº¡o sáº£n pháº©m
   â†“
[Seller] Nháº­p thÃ´ng tin:
   â”œâ”€ name (tÃªn sáº£n pháº©m)
   â”œâ”€ description (mÃ´ táº£ chi tiáº¿t)
   â”œâ”€ images (tá»‘i thiá»ƒu 3 áº£nh)
   â”œâ”€ categoryId (chá»n danh má»¥c)
   â”œâ”€ startPrice (giÃ¡ khá»Ÿi Ä‘iá»ƒm)
   â”œâ”€ stepPrice (bÆ°á»›c giÃ¡)
   â”œâ”€ buyNowPrice (optional - giÃ¡ mua ngay)
   â”œâ”€ endTime (thá»i gian káº¿t thÃºc)
   â”œâ”€ autoExtend (checkbox - cÃ³ gia háº¡n tá»± Ä‘á»™ng khÃ´ng)
   â””â”€ allowNonRatedBidders (checkbox - cho phÃ©p bidder chÆ°a cÃ³ rating)
   â†“
[POST /seller/products/create]
   â†“
[Backend] routes/seller/product.route.js
   â†“
[Validation]
   â”œâ”€ Check images.length >= 3
   â”œâ”€ Check startPrice > 0
   â”œâ”€ Check stepPrice > 0
   â”œâ”€ Check buyNowPrice >= startPrice (náº¿u cÃ³)
   â””â”€ Check endTime > now
   â†“
[Backend] services/product.service.js
   â”œâ”€ Create product: {
   â”‚    sellerId: req.session.authUser._id,
   â”‚    name, description, images, categoryId,
   â”‚    startPrice, stepPrice, buyNowPrice,
   â”‚    endTime, autoExtend, allowNonRatedBidders,
   â”‚    status: 'active',
   â”‚    blockedBidders: []
   â”‚  }
   â””â”€ Save to Product table
   â†“
[Response] Redirect to /seller/products

NOTE: âŒ Lá»–I - KHÃ”NG kiá»ƒm tra seller cÃ²n háº¡n (sellerEndDate)

================================================================================
4. LUá»’NG Äáº¤U GIÃ (AUTO-BID)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. XEM Sáº¢N PHáº¨M & QUYáº¾T Äá»ŠNH Äáº¤U GIÃ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Truy cáº­p /products/:id
   â†“
[Backend] routes/product.route.js
   â†“
[Backend] services/product.service.js
   â”œâ”€ Find product by ID
   â”œâ”€ Populate: categoryId, sellerId
   â”œâ”€ Get currentPrice (tá»« top bid hoáº·c startPrice)
   â”œâ”€ Get bidCount
   â”œâ”€ Get topBidder
   â”œâ”€ Get questions (Q&A)
   â””â”€ Get relatedProducts (cÃ¹ng category)
   â†“
[Frontend] views/vwProducts/detail.handlebars
   â”œâ”€ Hiá»ƒn thá»‹ thÃ´ng tin sáº£n pháº©m
   â”œâ”€ Hiá»ƒn thá»‹ current price
   â”œâ”€ Hiá»ƒn thá»‹ top bidder (MASKED: ****VanA)
   â”œâ”€ Hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng bid
   â”œâ”€ Hiá»ƒn thá»‹ thá»i gian cÃ²n láº¡i
   â””â”€ Hiá»ƒn thá»‹ nÃºt "Place Bid"
   â†“
[User] Click "Place Bid"
   â†“
[Redirect] /bidder/bid/:productId

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. Äáº¶T GIÃ (AUTO-BID)                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[GET /bidder/bid/:productId]
   â†“
[Backend] routes/bidder/bid.route.js
   â†“
[Backend] Fetch product info
   â”œâ”€ Get current price
   â”œâ”€ Calculate minBidAmount = currentPrice + stepPrice
   â””â”€ Get top bidder
   â†“
[Frontend] views/vwBidder/bid.handlebars
   â”œâ”€ Hiá»ƒn thá»‹ current price
   â”œâ”€ Hiá»ƒn thá»‹ minimum bid
   â””â”€ Form:
       - bidAmount (giÃ¡ Ä‘áº·t hiá»‡n táº¡i)
       - maxBidAmount (giÃ¡ tá»‘i Ä‘a - optional)
   â†“
[User] Nháº­p:
   â”œâ”€ bidAmount: 1000 (vÃ­ dá»¥)
   â””â”€ maxBidAmount: 5000 (vÃ­ dá»¥)
   â†“
[POST /bidder/bid/:productId]
   â†“
[Backend] routes/bidder/bid.route.js
   â†“
[Validation 1] Check product status
   â”œâ”€ product.status !== 'active' â†’ ERROR
   â””â”€ new Date() > product.endTime â†’ ERROR
   â†“
[Validation 2] Check bidder permissions
   â”œâ”€ bidderId === sellerId â†’ ERROR "Cannot bid on own product"
   â”œâ”€ bidderId in product.blockedBidders â†’ ERROR "You are blocked"
   â””â”€ Continue
   â†“
[Validation 3] Check rating (services/bid.service.js â†’ validateBidder)
   â”œâ”€ Get user rating: positive, negative, total, percent
   â”œâ”€ IF total === 0 AND !allowNonRatedBidders â†’ ERROR
   â”œâ”€ IF percent < 80% â†’ ERROR "Need at least 80% rating"
   â””â”€ Continue
   â†“
[Validation 4] Check minimum bid
   â”œâ”€ minBidAmount = currentPrice + stepPrice
   â”œâ”€ IF bidAmount < minBidAmount â†’ ERROR
   â””â”€ Continue
   â†“
[Backend] services/bid.service.js â†’ placeBid()
   â†“
[Get] topBid = getTopBidder(productId)
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CASE 1: CHÆ¯A CÃ“ AI BID (topBid === null)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”œâ”€ finalBidAmount = bidAmount
   â”œâ”€ isAutoBid = false
   â”œâ”€ Create bid: {
   â”‚    productId, bidderId, 
   â”‚    bidAmount: finalBidAmount,
   â”‚    maxBidAmount: maxBidAmount,
   â”‚    isAutoBid
   â”‚  }
   â”œâ”€ Update product.currentPrice = bidAmount
   â””â”€ SUCCESS â†’ You are now the top bidder!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CASE 2: ÄÃƒ CÃ“ NGÆ¯á»œI Äáº¶T (topBid cÃ³ maxBidAmount)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   SUB-CASE 2A: User B Ä‘áº·t KHÃ”NG dÃ¹ng auto-bid (maxBidAmount === null)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”œâ”€ IF bidAmount <= topBid.maxBidAmount
   â”‚   â”œâ”€ Há»‡ thá»‘ng AUTO-BID cho A lÃªn: 
   â”‚   â”‚   autoBidAmount = min(bidAmount, topBid.maxBidAmount)
   â”‚   â”‚                                    ^^^^^^^^^^^^
   â”‚   â”‚   âŒ Lá»–I CODE: min(bidAmount + stepPrice, topBid.maxBidAmount)
   â”‚   â”œâ”€ Create bid cho A: {
   â”‚   â”‚    bidderId: topBid.bidderId,
   â”‚   â”‚    bidAmount: autoBidAmount,
   â”‚   â”‚    maxBidAmount: topBid.maxBidAmount,
   â”‚   â”‚    isAutoBid: true
   â”‚   â”‚  }
   â”‚   â”œâ”€ Update product.currentPrice = autoBidAmount
   â”‚   â””â”€ RETURN { success: false, message: "Outbid by auto-bid" }
   â”‚
   â””â”€ ELSE (bidAmount > topBid.maxBidAmount)
       â”œâ”€ B thÃ nh top bidder
       â”œâ”€ finalBidAmount = bidAmount
       â”œâ”€ Create bid cho B
       â”œâ”€ Update product.currentPrice = bidAmount
       â””â”€ SUCCESS â†’ You are now the top bidder!

   SUB-CASE 2B: User B Ä‘áº·t DÃ™NG auto-bid (maxBidAmount !== null)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”œâ”€ IF maxBidAmount <= topBid.maxBidAmount
   â”‚   â”œâ”€ A váº«n tháº¯ng (max bid cao hÆ¡n)
   â”‚   â”œâ”€ autoBidAmount = min(maxBidAmount, topBid.maxBidAmount)
   â”‚   â”œâ”€ Create bid cho A (auto)
   â”‚   â”œâ”€ Update product.currentPrice = autoBidAmount
   â”‚   â””â”€ RETURN { success: false, message: "Outbid by auto-bid" }
   â”‚
   â””â”€ ELSE (maxBidAmount > topBid.maxBidAmount)
       â”œâ”€ B tháº¯ng (max bid cao hÆ¡n)
       â”œâ”€ finalBidAmount = min(topBid.maxBidAmount + stepPrice, maxBidAmount)
       â”œâ”€ isAutoBid = true
       â”œâ”€ Create bid cho B: {
       â”‚    bidAmount: finalBidAmount,
       â”‚    maxBidAmount: maxBidAmount,
       â”‚    isAutoBid: true
       â”‚  }
       â”œâ”€ Update product.currentPrice = finalBidAmount
       â””â”€ SUCCESS â†’ You are now the top bidder!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ C. Gá»¬I EMAIL THÃ”NG BÃO                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[After successful bid]
   â†“
[Backend] utils/email.js â†’ sendBidPlacedEmail()
   â”œâ”€ Send to: Seller
   â”œâ”€ Subject: "New bid on your product"
   â”œâ”€ Body: Product name, current price, bidder name
   â””â”€ Send email
   â†“
[Backend] utils/email.js â†’ sendBidPlacedEmail()
   â”œâ”€ Send to: All bidders (who participated)
   â”œâ”€ Subject: "New bid on watched product"
   â””â”€ Send email

================================================================================
5. LUá»’NG GIA Háº N PHIÃŠN Äáº¤U GIÃ (AUTO-EXTEND)
================================================================================

[Trigger] Má»—i khi cÃ³ bid má»›i
   â†“
[Backend] services/bid.service.js â†’ placeBid()
   â†“
[Check] product.autoExtend === true?
   â”œâ”€ NO â†’ Skip auto-extend
   â””â”€ YES â†’ Continue
   â†“
[Get config] From .env
   â”œâ”€ thresholdMinutes = AUTO_EXTEND_THRESHOLD_MINUTES (default: 5)
   â””â”€ extendMinutes = AUTO_EXTEND_DURATION_MINUTES (default: 10)
   â†“
[Calculate] thresholdTime = endTime - thresholdMinutes
   â†“
[Check] Bid time >= thresholdTime?
   â”œâ”€ NO â†’ KhÃ´ng gia háº¡n (bid Ä‘áº·t sá»›m)
   â””â”€ YES â†’ Gia háº¡n
   â†“
[Extend]
   â”œâ”€ newEndTime = endTime + extendMinutes
   â”œâ”€ Update product.endTime = newEndTime
   â””â”€ Save

VÃ Dá»¤:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Product endTime: 10:00 PM
Threshold: 5 phÃºt â†’ 9:55 PM
Extend: 10 phÃºt

Scenario 1: Bid Ä‘áº·t lÃºc 9:50 PM
   â†’ KHÃ”NG gia háº¡n (chÆ°a Ä‘áº¿n threshold)
   â†’ endTime váº«n 10:00 PM

Scenario 2: Bid Ä‘áº·t lÃºc 9:57 PM
   â†’ Gia háº¡n (Ä‘Ã£ vÃ o threshold)
   â†’ endTime = 10:00 PM + 10 phÃºt = 10:10 PM

Scenario 3: Bid tiáº¿p lÃºc 10:08 PM
   â†’ Láº¡i gia háº¡n (váº«n trong threshold má»›i)
   â†’ endTime = 10:10 PM + 10 phÃºt = 10:20 PM

================================================================================
6. LUá»’NG Káº¾T THÃšC Äáº¤U GIÃ
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. BACKGROUND JOB KIá»‚M TRA                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Startup] app.js khá»Ÿi Ä‘á»™ng
   â†“
[Import] jobs/auction-end.job.js
   â†“
[Job] setInterval(checkEndedAuctions, 10 * 60 * 1000)
   â†‘                                   â””â”€â”€ Cháº¡y má»—i 10 phÃºt
   â”‚
   â””â”€â”€â”€ Loop forever

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. Xá»¬ LÃ Káº¾T THÃšC                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Function] checkEndedAuctions()
   â†“
[Query] Find products:
   â”œâ”€ status === 'active'
   â”œâ”€ endTime <= now
   â””â”€ Sort by endTime ASC
   â†“
[Loop] For each product:
   â†“
   [Get] topBid = getTopBidder(productId)
   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CASE 1: CÃ“ NGÆ¯á»œI THáº®NG (topBid !== null)            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”œâ”€ Update product:
   â”‚   â”œâ”€ status = 'ended'
   â”‚   â””â”€ Save
   â”œâ”€ Create transaction:
   â”‚   â”œâ”€ productId
   â”‚   â”œâ”€ buyerId = topBid.bidderId
   â”‚   â”œâ”€ sellerId = product.sellerId
   â”‚   â”œâ”€ finalPrice = topBid.bidAmount
   â”‚   â”œâ”€ step = 1 (waiting payment proof)
   â”‚   â””â”€ status = 'pending'
   â”œâ”€ Send email to winner:
   â”‚   â”œâ”€ Subject: "Congratulations! You won the auction"
   â”‚   â””â”€ Body: Product info, final price, checkout link
   â””â”€ Send email to seller:
       â”œâ”€ Subject: "Your auction has ended"
       â””â”€ Body: Winner info, final price

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CASE 2: KHÃ”NG CÃ“ AI BID (topBid === null)           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”œâ”€ Update product:
   â”‚   â”œâ”€ status = 'ended'
   â”‚   â””â”€ Save
   â””â”€ Send email to seller:
       â”œâ”€ Subject: "Your auction has ended"
       â””â”€ Body: "No bids received"

================================================================================
7. LUá»’NG CHECKOUT (4 BÆ¯á»šC)
================================================================================

[Trigger] Auction ended vá»›i winner
   â†“
[Create] Transaction: { step: 1, status: 'pending' }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: BUYER SUBMIT PAYMENT PROOF                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Winner] Truy cáº­p /checkout/:productId
   â†“
[Backend] routes/checkout.route.js
   â†“
[Check] User === winner?
   â”œâ”€ NO â†’ Return 403 "Not authorized"
   â””â”€ YES â†’ Continue
   â†“
[Frontend] views/vwCheckout/index.handlebars
   â”œâ”€ Hiá»ƒn thá»‹ product info
   â”œâ”€ Hiá»ƒn thá»‹ final price
   â””â”€ Form step 1:
       - paymentProof (text - link áº£nh chuyá»ƒn khoáº£n)
       - shippingAddress (text)
   â†“
[Winner] Nháº­p thÃ´ng tin â†’ Submit
   â†“
[POST /checkout/:id/step1]
   â†“
[Backend] services/transaction.service.js
   â”œâ”€ Update transaction:
   â”‚   â”œâ”€ paymentProof
   â”‚   â”œâ”€ shippingAddress
   â”‚   â”œâ”€ step = 2
   â”‚   â””â”€ Save
   â””â”€ Send email to seller: "Buyer submitted payment proof"
   â†“
[Response] Redirect back to /checkout/:id

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: SELLER CONFIRM PAYMENT                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Seller] Truy cáº­p /checkout/:productId
   â†“
[Check] User === seller?
   â””â”€ YES â†’ Continue
   â†“
[Frontend] Hiá»ƒn thá»‹:
   â”œâ”€ Payment proof tá»« buyer
   â”œâ”€ Shipping address
   â””â”€ Form step 2:
       - trackingNumber (text - mÃ£ váº­n Ä‘Æ¡n)
   â†“
[Seller] Confirm payment â†’ Nháº­p tracking number â†’ Submit
   â†“
[POST /checkout/:id/step2]
   â†“
[Backend] services/transaction.service.js
   â”œâ”€ Update transaction:
   â”‚   â”œâ”€ trackingNumber
   â”‚   â”œâ”€ step = 3
   â”‚   â””â”€ Save
   â””â”€ Send email to buyer: "Seller confirmed payment, here's tracking"
   â†“
[Response] Redirect back

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: BUYER CONFIRM DELIVERY                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Winner] Truy cáº­p /checkout/:productId
   â†“
[Frontend] Hiá»ƒn thá»‹ tracking number
   â†“
[Winner] Nháº­n hÃ ng â†’ Click "Confirm Delivery"
   â†“
[POST /checkout/:id/step3]
   â†“
[Backend] services/transaction.service.js
   â”œâ”€ Update transaction:
   â”‚   â”œâ”€ step = 4
   â”‚   â”œâ”€ status = 'completed'
   â”‚   â””â”€ Save
   â””â”€ Send email to seller: "Buyer confirmed delivery"
   â†“
[Response] Redirect to rating page

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: RATING (Xem pháº§n 8)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
8. LUá»’NG ÄÃNH GIÃ (RATING)
================================================================================

[Trigger] Transaction step = 4 (completed)
   â†“
[Frontend] Hiá»ƒn thá»‹ form rating cho cáº£ Seller vÃ  Winner

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. SELLER ÄÃNH GIÃ WINNER                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Seller] Truy cáº­p /seller/products/ended
   â†“
[Frontend] Hiá»ƒn thá»‹ danh sÃ¡ch ended auctions
   â†“
[For each] CÃ³ winner + chÆ°a rate
   â†“
[Frontend] Hiá»ƒn thá»‹ form:
   â”œâ”€ Radio: +1 (Positive) hoáº·c -1 (Negative)
   â””â”€ Textarea: comment (optional)
   â†“
[Seller] Chá»n rating â†’ Submit
   â†“
[POST /seller/products/rate/:productId/:userId]
   â†“
[Backend] routes/seller/product.route.js
   â†“
[Backend] services/rating.service.js â†’ createOrUpdate()
   â”œâ”€ Check existing rating: findExisting(productId, fromUserId, toUserId)
   â”œâ”€ IF exists â†’ Update
   â”œâ”€ ELSE â†’ Create new: {
   â”‚    productId,
   â”‚    fromUserId: sellerId,
   â”‚    toUserId: winnerId,
   â”‚    rating: +1 hoáº·c -1,
   â”‚    comment,
   â”‚    type: 'seller_to_bidder'
   â”‚  }
   â””â”€ Save
   â†“
[Calculate] User rating percentage
   â”œâ”€ Get all ratings for user: toUserId
   â”œâ”€ positive = count(rating === 1)
   â”œâ”€ negative = count(rating === -1)
   â”œâ”€ total = positive + negative
   â””â”€ percent = (positive / total) * 100
   â†“
[Response] Redirect back

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. WINNER ÄÃNH GIÃ SELLER                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Winner] Truy cáº­p /checkout/:productId
   â†“
[Frontend] Hiá»ƒn thá»‹ form rating tÆ°Æ¡ng tá»±
   â†“
[Winner] Submit rating
   â†“
[POST] Similar flow, type: 'bidder_to_seller'

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ C. XEM RATING Cá»¦A USER                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Anyone] Truy cáº­p /account/ratings (view own ratings)
   â†“
[Backend] services/rating.service.js â†’ findByUserId()
   â”œâ”€ Find all ratings: toUserId = currentUser
   â”œâ”€ Populate fromUserId, productId
   â””â”€ Return { items, pagination }
   â†“
[Frontend] Hiá»ƒn thá»‹ danh sÃ¡ch ratings
   â”œâ”€ Calculate: positive, negative, total, percent
   â””â”€ Display each rating with comment

================================================================================
9. LUá»’NG Q&A (Há»I ÄÃP)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. Äáº¶T CÃ‚U Há»I                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Xem product detail: /products/:id
   â†“
[Frontend] Scroll to Q&A section
   â†“
[User] Click "Ask Question"
   â†“
[Frontend] Hiá»ƒn thá»‹ form: textarea (question)
   â†“
[User] Nháº­p cÃ¢u há»i â†’ Submit
   â†“
[POST /bidder/questions/:productId]
   â†“
[Backend] routes/bidder/question.route.js
   â†“
[Backend] services/question.service.js
   â”œâ”€ Create: {
   â”‚    productId,
   â”‚    askerId: currentUser._id,
   â”‚    question: "...",
   â”‚    answer: null,
   â”‚    createdAt
   â”‚  }
   â””â”€ Save to ProductQuestion table
   â†“
[Backend] utils/email.js â†’ sendNewQuestionEmail()
   â”œâ”€ Send to: Seller
   â”œâ”€ Subject: "New question on your product"
   â””â”€ Body: Question text, asker name, product link
   â†“
[Response] Redirect back to product page

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. TRáº¢ Lá»œI CÃ‚U Há»I                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Seller] Xem product detail hoáº·c seller dashboard
   â†“
[Frontend] Hiá»ƒn thá»‹ questions chÆ°a tráº£ lá»i (answer === null)
   â†“
[Seller] Click "Answer" â†’ Nháº­p answer â†’ Submit
   â†“
[POST /seller/questions/:id/answer]
   â†“
[Backend] routes/seller/question.route.js
   â†“
[Check] currentUser === product.sellerId?
   â”œâ”€ NO â†’ Return 403 "Not authorized"
   â””â”€ YES â†’ Continue
   â†“
[Backend] services/question.service.js
   â”œâ”€ Update question: {
   â”‚    answer: "...",
   â”‚    answeredAt: new Date()
   â”‚  }
   â””â”€ Save
   â†“
[Backend] utils/email.js â†’ sendQuestionAnswerEmail()
   â”œâ”€ Send to: All bidders who bid on this product
   â”œâ”€ Subject: "New answer on product you're watching"
   â””â”€ Body: Question + Answer, product link
   â†“
[Response] Redirect back

NOTE: âŒ Lá»–I - UI khÃ´ng kiá»ƒu Facebook reply, email thiáº¿u link sáº£n pháº©m

================================================================================
10. LUá»’NG WATCHLIST
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. THÃŠM VÃ€O WATCHLIST                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Xem product detail: /products/:id
   â†“
[Frontend] Hiá»ƒn thá»‹ nÃºt "Add to Watchlist"
   â†“
[User] Click button
   â†“
[POST /bidder/watchlist/:productId]
   â†“
[Backend] routes/bidder/watchlist.route.js
   â†“
[Backend] services/watchlist.service.js
   â”œâ”€ Check existing: findByUserAndProduct(userId, productId)
   â”œâ”€ IF exists â†’ Return error "Already in watchlist"
   â”œâ”€ Create: {
   â”‚    userId: currentUser._id,
   â”‚    productId,
   â”‚    createdAt
   â”‚  }
   â””â”€ Save to Watchlist table
   â†“
[Response] Redirect back to product page

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. XEM WATCHLIST                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Truy cáº­p /bidder/watchlist
   â†“
[Backend] routes/bidder/watchlist.route.js
   â†“
[Backend] services/watchlist.service.js â†’ findByUserId()
   â”œâ”€ Find all: userId = currentUser
   â”œâ”€ Populate productId (with all details)
   â”œâ”€ For each product:
   â”‚   â”œâ”€ Get currentPrice
   â”‚   â”œâ”€ Get bidCount
   â”‚   â””â”€ Get topBidder
   â””â”€ Return { items, pagination }
   â†“
[Frontend] views/vwBidder/watchlist.handlebars
   â””â”€ Hiá»ƒn thá»‹ danh sÃ¡ch products

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ C. XÃ“A KHá»I WATCHLIST                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Click "Remove"
   â†“
[DELETE /bidder/watchlist/:productId]
   â†“
[Backend] services/watchlist.service.js
   â””â”€ Delete: findOneAndDelete({ userId, productId })
   â†“
[Response] Redirect back

================================================================================
11. LUá»’NG SEARCH & FILTER
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. SEARCH THEO KEYWORD                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Nháº­p keyword vÃ o search box
   â†“
[GET /search?keyword=laptop]
   â†“
[Backend] routes/search.route.js
   â†“
[Backend] services/search.service.js â†’ search()
   â†“
[Query] Product.find({
   $text: { $search: keyword },
   status: 'active'
}).sort({ score: { $meta: 'textScore' } })
   â†‘
   â””â”€â”€ Text index on: name, description
   â†“
[Enrich] For each product:
   â”œâ”€ Get currentPrice
   â”œâ”€ Get bidCount
   â””â”€ Get topBidder
   â†“
[Response] Render search results

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. FILTER THEO CATEGORY                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User] Click category "Electronics"
   â†“
[GET /products?categoryId=123]
   â†“
[Backend] routes/product.route.js
   â†“
[Backend] services/product.service.js â†’ findByCategory(categoryId)
   â†“
[Query] Product.find({
   categoryId: categoryId,  â† âŒ Lá»–I: KhÃ´ng láº¥y category con
   status: 'active'
})
   â†“
ÄÃšNG PHáº¢I LÃ€:
   â”œâ”€ Get all child categories: [categoryId, child1, child2, ...]
   â””â”€ Query: categoryId: { $in: [categoryId, ...childIds] }
   â†“
[Response] Render product list

================================================================================
12. LUá»’NG ADMIN QUáº¢N LÃ
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A. QUáº¢N LÃ USERS                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Admin] Truy cáº­p /admin/users
   â†“
[Middleware] auth.mdw.js + check role === 'admin'
   â†“
[Backend] services/user.service.js â†’ findAll()
   â”œâ”€ Get all users (exclude password)
   â”œâ”€ Pagination
   â””â”€ Return
   â†“
[Frontend] views/vwAdmin/users/index.handlebars
   â””â”€ Hiá»ƒn thá»‹ table users

[Admin] Click "Edit" user
   â†“
[GET /admin/users/:id/edit]
   â†“
[Frontend] Form: name, email, role, dob, address
   â†“
[Admin] Update â†’ Submit
   â†“
[POST /admin/users/:id]
   â†“
[Backend] services/user.service.js â†’ update()
   â””â”€ Update user fields
   â†“
[Response] Redirect back

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B. QUáº¢N LÃ CATEGORIES                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Admin] /admin/categories
   â†“
[CRUD operations]
   â”œâ”€ Create: name, img_url, description, parentId
   â”œâ”€ Update: same fields
   â””â”€ Delete: check no products before delete

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ C. QUáº¢N LÃ PRODUCTS                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Admin] /admin/products
   â†“
[View] All products (active, ended, cancelled)
   â†“
[Admin] Can:
   â”œâ”€ View details
   â”œâ”€ Cancel product (set status = 'cancelled')
   â””â”€ Delete product

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ D. APPROVE SELLER REQUESTS (Ä‘Ã£ mÃ´ táº£ á»Ÿ pháº§n 2)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
13. LUá»’NG BLOCK BIDDER
================================================================================

[Seller] Xem product detail hoáº·c bid history
   â†“
[Seller] Click "Block Bidder" trÃªn 1 bidder cá»¥ thá»ƒ
   â†“
[POST /seller/products/:productId/block/:bidderId]
   â†“
[Backend] routes/seller/product.route.js
   â†“
[Backend] services/bid.service.js â†’ blockBidder()
   â†“
[Update] product.blockedBidders.push(bidderId)
   â†“
NOTE: âŒ Lá»–I - KhÃ´ng check náº¿u bidder Ä‘ang top â†’ revert vá» bid #2
   â†“
[Save] product
   â†“
[Response] Redirect back

EFFECT:
   â””â”€ Bidder bá»‹ block khÃ´ng thá»ƒ Ä‘áº·t bid má»›i (validateBidder check)

================================================================================
14. LUá»’NG APPEND DESCRIPTION (SELLER)
================================================================================

[Seller] Xem product detail cá»§a sáº£n pháº©m mÃ¬nh
   â†“
[Frontend] Hiá»ƒn thá»‹ nÃºt "Append Description"
   â†“
[Seller] Click â†’ Nháº­p mÃ´ táº£ bá»• sung â†’ Submit
   â†“
[POST /seller/products/:id/append-description]
   â†“
[Backend] routes/seller/product.route.js
   â†“
[Backend] services/product.service.js â†’ appendDescription()
   â”œâ”€ Push to array: product.appendedDescriptions.push({
   â”‚    content: "...",
   â”‚    timestamp: new Date()
   â”‚  })
   â””â”€ Save
   â†“
[Frontend] Hiá»ƒn thá»‹ mÃ´ táº£ bá»• sung vá»›i timestamp

NOTE: KhÃ´ng Ä‘Æ°á»£c Sá»¬A description gá»‘c, chá»‰ Ä‘Æ°á»£c THÃŠM

================================================================================
15. LUá»’NG EMAIL NOTIFICATIONS
================================================================================

Há»† THá»NG Gá»¬I EMAIL TRONG CÃC TRÆ¯á»œNG Há»¢P:

1. ÄÄƒng kÃ½ â†’ OTP verification
2. QuÃªn máº­t kháº©u â†’ Reset password link
3. Bid má»›i â†’ Seller + All bidders
4. Question má»›i â†’ Seller
5. Answer má»›i â†’ All bidders
6. Auction ended â†’ Winner + Seller
7. Checkout step completed â†’ Buyer / Seller

[Backend] utils/email.js â†’ sendEmail()
   â”œâ”€ Use: nodemailer
   â”œâ”€ SMTP config from .env:
   â”‚   â”œâ”€ EMAIL_HOST
   â”‚   â”œâ”€ EMAIL_PORT
   â”‚   â”œâ”€ EMAIL_USER
   â”‚   â””â”€ EMAIL_PASSWORD
   â””â”€ Send transactional emails

================================================================================
Tá»”NG Káº¾T CÃC LUá»’NG CHÃNH
================================================================================

âœ… HOÃ€N CHá»ˆNH:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ ÄÄƒng kÃ½ / ÄÄƒng nháº­p vá»›i OTP
â€¢ Xin quyá»n seller (cÆ¡ báº£n - thiáº¿u expiration)
â€¢ Táº¡o sáº£n pháº©m
â€¢ Äáº¥u giÃ¡ vá»›i auto-bid (thiáº¿u validate trÆ°á»›c)
â€¢ Auto-extend auction
â€¢ Káº¿t thÃºc Ä‘áº¥u giÃ¡ tá»± Ä‘á»™ng (background job)
â€¢ Checkout 4 bÆ°á»›c
â€¢ Rating 2 chiá»u (+1/-1)
â€¢ Q&A (thiáº¿u UI tá»‘t hÆ¡n)
â€¢ Watchlist
â€¢ Search & Filter (thiáº¿u category hierarchy)
â€¢ Admin quáº£n lÃ½

âŒ THIáº¾U / SAI:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Seller expiration (7 ngÃ y) - CHÆ¯A CÃ“
â€¢ Buy now logic - CHÆ¯A CÃ“
â€¢ Auto-bid formula - SAI (cá»™ng step thá»«a)
â€¢ Rating validation - KhÃ´ng hiá»ƒn thá»‹ trÆ°á»›c khi bid
â€¢ Category filter - KhÃ´ng láº¥y category con
â€¢ Block bidder - KhÃ´ng revert price
â€¢ Update max bid - KhÃ´ng support
â€¢ Q&A UI - ChÆ°a kiá»ƒu Facebook reply
â€¢ Email - Thiáº¿u link sáº£n pháº©m

================================================================================
Káº¾T THÃšC MÃ” Táº¢ LUá»’NG HOáº T Äá»˜NG
================================================================================
