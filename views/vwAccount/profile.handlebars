<div
  class="max-w-2xl mx-auto my-20 p-8 bg-white rounded-3xl shadow-[0_4px_20px_rgba(0,0,0,0.08)] border border-gray-200/60"
>
  <h2 class="text-[28px] font-semibold text-gray-900 text-center mb-8">
    Profile
  </h2>
  <div class="space-y-4 mb-8">
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600">Name</div>
      <div class="text-gray-900 font-medium">{{authUser.name}}</div>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600">Email</div>
      <div class="text-gray-900 font-medium">{{authUser.email}}</div>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600">Date of Birth</div>
      <div class="text-gray-900 font-medium">
        {{#if authUser.dob}} {{formatDate authUser.dob}} {{else}} Not set
        {{/if}}
      </div>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600">Address</div>
      <div class="text-gray-900 font-medium">
        {{#if authUser.address}} {{authUser.address}} {{else}} Not set {{/if}}
      </div>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600">Role</div>
      <div class="text-gray-900 font-medium capitalize">
        {{#if (eq authUser.role 'admin')}} Admin {{else}} Bidder {{/if}}
      </div>
    </div>
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="text-sm text-gray-600 mb-2">Rating Score</div>
      {{> rating/rating-display ratingStats=ratingStats modalId="ratingsModal"
      compact=false }}
    </div>
    {{#if sellerRequest}}
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="flex items-center justify-between mb-2">
        <div class="text-sm text-gray-600">Seller Request Status</div>
        <span
          class="inline-block px-3 py-1 rounded-full text-xs font-medium {{#if (eq sellerRequest.status 'pending')}}bg-yellow-100 text-yellow-800{{else if (eq sellerRequest.status 'approved')}}bg-green-100 text-green-800{{else}}bg-red-100 text-red-800{{/if}}"
        >
          {{sellerRequest.status}}
        </span>
      </div>
      {{#if (eq sellerRequest.status 'pending')}}
      <div class="text-gray-600 text-sm">
        Requested at {{formatDate sellerRequest.createdAt}}
      </div>
      {{else if sellerRequest.reviewedAt}}
      <div class="text-gray-600 text-sm">
        Reviewed at {{formatDate sellerRequest.reviewedAt}}
      </div>
      {{/if}}
    </div>
    {{/if}} {{#if authUser.sellerExpiresAt}}
    <div class="p-4 bg-gray-50 rounded-xl">
      <div class="flex items-center justify-between mb-2">
        <div class="text-sm text-gray-600">Seller Permission</div>
        <span
          class="inline-block px-3 py-1 rounded-full text-xs font-medium {{#if isSellerExpired}}bg-red-100 text-red-800{{else}}bg-green-100 text-green-800{{/if}}"
        >
          {{#if isSellerExpired}}Expired{{else}}Active{{/if}}
        </span>
      </div>
      {{#unless isSellerExpired}}
      <div class="text-gray-600 text-sm">
        Expires at {{formatDate authUser.sellerExpiresAt}}
      </div>
      {{/unless}}
    </div>
    {{/if}}
  </div>
  <div class="flex gap-4 mb-6">
    <button
      onclick="document.getElementById('editProfileModal').classList.remove('hidden')"
      class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl shadow-[0_4px_20px_rgba(37,99,235,0.3)] hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-300 ease-out font-medium"
    >
      Edit Profile
    </button>
    <button
      onclick="document.getElementById('changeEmailModal').classList.remove('hidden')"
      class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl shadow-[0_4px_20px_rgba(37,99,235,0.3)] hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-300 ease-out font-medium"
    >
      Change Email
    </button>
    <button
      onclick="document.getElementById('changePasswordModal').classList.remove('hidden')"
      class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl shadow-[0_4px_20px_rgba(37,99,235,0.3)] hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-300 ease-out font-medium"
    >
      Change Password
    </button>
  </div>
  {{#unless (eq authUser.role 'admin')}} {{#if (or (not
  authUser.sellerExpiresAt) isSellerExpired)}} {{#unless (and sellerRequest (eq
  sellerRequest.status 'pending'))}} {{#unless (and authUser.sellerExpiresAt
  (not isSellerExpired))}}
  <form
    method="post"
    action="/account/request-seller"
    id="requestSellerForm"
    class="mb-6"
  >
    <button
      type="button"
      id="requestSellerBtn"
      class="w-full px-6 py-3 bg-blue-600 text-white rounded-xl shadow-[0_4px_20px_rgba(37,99,235,0.3)] hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-300 ease-out font-medium"
    >
      Request Seller Account
    </button>
  </form>
  {{/unless}} {{/unless}} {{/if}} {{/unless}}
</div>
{{> rating/rating-history-modal modalId="ratingsModal" title="My Ratings"
userId=authUser._id userName=authUser.name staticRatings=ratings }} {{#> modal
id="otpModal" title="Verify Email Change"}}
<form
  method="post"
  action="/account/verify-email-change"
  id="frmVerifyOTP"
  class="space-y-6"
>
  <p class="text-gray-600 text-center mb-6">
    Please enter the OTP code sent to your new email address.
  </p>
  <div class="relative mb-6">
    <input
      type="text"
      id="otpCode"
      name="code"
      maxlength="6"
      class="w-full px-4 py-4 border border-gray-200/60 rounded-2xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900 text-center text-2xl tracking-widest"
      placeholder="000000"
      required
      autofocus
    />
  </div>
  <button
    type="submit"
    class="w-full px-6 py-4 bg-blue-600 text-white rounded-xl shadow-[0_4px_20px_rgba(37,99,235,0.3)] hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-300 ease-out font-medium"
  >
    Verify
  </button>
</form>
{{/modal}} {{#> modal id="editProfileModal" title="Edit Profile"}}
<form method="post" action="/account/edit" id="frmEdit" class="space-y-4">
  <div>
    <label for="name" class="block text-sm font-medium text-gray-900 mb-2"
      >Full Name</label
    >
    <input
      type="text"
      id="name"
      name="name"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Full Name"
      value="{{authUser.name}}"
      required
    />
  </div>
  <div>
    <label for="dob" class="block text-sm font-medium text-gray-900 mb-2"
      >Date of Birth</label
    >
    <input type="date" id="dob" name="dob" class="w-full px-4 py-3 border
    border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10
    focus:outline-none transition-all duration-300 text-gray-900" {{#if
    authUser.dob}} value="{{formatDate authUser.dob}}" {{/if}} />
  </div>
  <div>
    <label for="address" class="block text-sm font-medium text-gray-900 mb-2"
      >Address</label
    >
    <input
      type="text"
      id="address"
      name="address"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Address"
      value="{{authUser.address}}"
    />
  </div>
  <button
    type="submit"
    class="w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium"
  >
    Update Profile
  </button>
</form>
{{/modal}} {{#> modal id="changePasswordModal" title="Change Password"}}
<form
  method="post"
  action="/account/change-password"
  id="frmChangePassword"
  class="space-y-4"
>
  <div>
    <label
      for="oldPassword"
      class="block text-sm font-medium text-gray-900 mb-2"
      >Current Password</label
    >
    <input
      type="password"
      id="oldPassword"
      name="oldPassword"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Enter current password"
      required
    />
  </div>
  <div>
    <label for="password" class="block text-sm font-medium text-gray-900 mb-2"
      >New Password</label
    >
    <input
      type="password"
      id="password"
      name="password"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Enter new password"
      required
    />
  </div>
  <div>
    <label
      for="confirmPassword"
      class="block text-sm font-medium text-gray-900 mb-2"
      >Confirm New Password</label
    >
    <input
      type="password"
      id="confirmPassword"
      name="confirmPassword"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Confirm new password"
      required
    />
  </div>
  <button
    type="submit"
    class="w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium"
  >
    Change Password
  </button>
</form>
{{/modal}} {{#> modal id="changeEmailModal" title="Change Email"}}
<form
  method="post"
  action="/account/change-email"
  id="frmChangeEmail"
  class="space-y-4"
>
  <div>
    <label
      for="currentEmail"
      class="block text-sm font-medium text-gray-900 mb-2"
      >Current Email</label
    >
    <input
      type="email"
      id="currentEmail"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900 bg-gray-50"
      value="{{authUser.email}}"
      disabled
    />
  </div>
  <div>
    <label for="newEmail" class="block text-sm font-medium text-gray-900 mb-2"
      >New Email</label
    >
    <input
      type="email"
      id="newEmail"
      name="email"
      class="w-full px-4 py-3 border border-gray-200/60 rounded-xl focus:ring-2 focus:ring-black/10 focus:outline-none transition-all duration-300 text-gray-900"
      placeholder="Enter new email address"
      required
    />
  </div>
  <button
    type="submit"
    class="w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium"
  >
    Send Verification Code
  </button>
</form>
{{/modal}} {{#section "js"}}
<script>
  const requestSellerBtn = document.getElementById('requestSellerBtn')
  const requestSellerForm = document.getElementById('requestSellerForm')
  if (requestSellerBtn && requestSellerForm) {
    requestSellerBtn.addEventListener('click', function () {
      if (confirm('Are you sure you want to request seller status?')) {
        requestSellerForm.submit()
      }
    })
  }

  document
    .getElementById('frmChangePassword')
    .addEventListener('submit', function (e) {
      const password = document.getElementById('password').value
      const confirmPassword = document.getElementById('confirmPassword').value
      if (password !== confirmPassword) {
        e.preventDefault()
        alert('Password confirmation does not match.')
        return false
      }
    })

  document
    .getElementById('frmChangeEmail')
    .addEventListener('submit', function (e) {
      const currentEmail = document.getElementById('currentEmail').value
      const newEmail = document.getElementById('newEmail').value
      if (newEmail === currentEmail) {
        e.preventDefault()
        alert('New email must be different from current email.')
        return false
      }
      e.preventDefault()
      const form = this
      const formData = new FormData(form)
      fetch(form.action, {
        method: 'POST',
        body: formData,
      })
        .then(function (response) {
          if (response.ok || response.redirected) {
            const otpModal = document.getElementById('otpModal')
            if (otpModal) {
              otpModal.classList.remove('hidden')
              const otpCodeInput = document.getElementById('otpCode')
              if (otpCodeInput) {
                otpCodeInput.focus()
                otpCodeInput.addEventListener('input', function (e) {
                  this.value = this.value.replace(/[^0-9]/g, '')
                })
              }
            }
            document.getElementById('changeEmailModal').classList.add('hidden')
          } else {
            alert('An error occurred. Please try again.')
          }
        })
        .catch(function (error) {
          console.error('Error:', error)
          alert('An error occurred. Please try again.')
        })
      return false
    })
</script>
{{/section}}
